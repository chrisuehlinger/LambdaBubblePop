<html>
  <head>
   <!-- Bower Components -->
    <script src="bower_components/react/react-with-addons.js"></script>
    <script src="bower_components/lodash/dist/lodash.js"></script>
    <script src="bower_components/node-uuid/uuid.js"></script>

    <!-- Line Components -->
    <script src="components/Mixins.js"></script>
    <script src="components/LineComponent.js"></script>
    <script src="components/ApplicationComponent.js"></script>
    <script src="components/FunctionNameComponent.js"></script>
    <script src="components/ListComponent.js"></script>
    <script src="components/IntComponent.js"></script>
    <script src="components/LinesComponent.js"></script>
    <script src="components/NodeComponent.js"></script>

    <!-- AST Operations -->
    <script src="ast_transformations.js"></script>
    <script src="initial_ast.js"></script>

    <!-- Parser -->
    <script src="haskell-parser.js"></script>

    <!-- Functions -->
    <script src="functions/map.js"></script>
    <script src="functions/plusOne.js"></script>
    <script src="functions/cons.js"></script>
    <script src="functions/plus.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="app.css">
  </head>
  <body>
    <div id="lines">
    </div>
  </body>
  <script>
    var _globalState = {
      lines: [{ast: window.initialAST, clickedComputationId: null}],
      applicationHighlightId: null,
      highlightedLineIndex: null,
      editingFirstLine: false,
      showHelpText: true
    };

    var changeGlobalState = function(globalStateDiff) {
      _.extend(_globalState, globalStateDiff);

      React.renderComponent(
        Lines(_globalState),
        document.getElementById('lines')
      );
    };
    changeGlobalState({});

    window.addLineByApplying = function(id) {
      var lines = _.cloneDeep(_globalState.lines);

      lines[lines.length-1].clickedComputationId = id;

      var applyInfo = ASTTransformations.applyFunction(lines[lines.length-1].ast, id);

      lines.push({
        ast: applyInfo.ast,
        clickedComputationId: null,
        justComputedId: applyInfo.justComputedId
      });

      changeGlobalState({lines: lines, showHelpText: false});
    };

    window.highlightApplicationId = function(id) {
      changeGlobalState({applicationHighlightId: id});
    };

    window.highlightLine = function(index) {
      changeGlobalState({highlightedLineIndex: index});
    };

    window.editFirstLine = function() {
      changeGlobalState({editingFirstLine: true});
    };

    window.updateInitialAST = function(id, subtree) {
      var newAST = ASTTransformations.replaceSubtree(_globalState.lines[0].ast, id, subtree);

      changeGlobalState({
        lines: [{ast: newAST, clickedComputationId: null}],
        applicationHighlightId: null,
        highlightedLineIndex: null,
        editingFirstLine: false,
        showHelpText: false
      });
    };
  </script>
</html>
