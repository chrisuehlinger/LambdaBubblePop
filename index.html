<html>
  <head>
   <!-- Bower Components -->
    <script src="bower_components/react/react-with-addons.js"></script>
    <script src="bower_components/lodash/dist/lodash.js"></script>
    <script src="bower_components/node-uuid/uuid.js"></script>

    <!-- Line Components -->
    <script src="components/Mixins.js"></script>
    <script src="components/LineComponent.js"></script>
    <script src="components/ApplicationComponent.js"></script>
    <script src="components/FunctionNameComponent.js"></script>
    <script src="components/ListComponent.js"></script>
    <script src="components/IntComponent.js"></script>
    <script src="components/LinesComponent.js"></script>
    <script src="components/NodeComponent.js"></script>

    <!-- AST Operations -->
    <script src="ast_transformations.js"></script>
    <script src="initial_ast.js"></script>

    <!-- Parser -->
    <script src="haskell-parser.js"></script>

    <!-- Functions -->
    <script src="functions/map.js"></script>
    <script src="functions/plusOne.js"></script>
    <script src="functions/cons.js"></script>
    <script src="functions/plus.js"></script>

    <!-- AST Node Types -->
    <script src="astNodeType/int.js"></script>
    <script src="astNodeType/list.js"></script>
    <script src="astNodeType/application.js"></script>
    <script src="astNodeType/functionName.js"></script>


    <!-- Styles -->
    <link rel="stylesheet" href="app.css">
  </head>
  <body>
    <div id="mapLesson">
      <div>
        Map is a function that performs some operation on every element in a list.
      </div>

      <pre>
        <span class="mapLessonTypeSignature">map :: (a -> b) -> [a] -> [b]</span>
        <span class="mapLessonBaseCase">map f [] = []</span>
        <span class="mapLessonRecursiveCase">map f (x:xs) = f x : map f xs</span>
      </pre>

      <div class="mapLessonTypeSignature" >
        It is a two input function; it takes a function of type <code>(a -> b)</code> and a list of type <code>[a]</code> and returns a list of type <code>[b]</code>.
      </div>

      <div class="mapLessonPatternMatches" style="padding-top: 10px;">
        <span class="mapLessonBaseCase">
          The base-case of <code>map</code> pattern-matches on the empty list (<code>[]</code>), which returns the empty list (<code>[]</code>).
        </span>
        <span class="mapLessonRecursiveCase">
           It accomplished this by pattern matching on the first element of the input list (<code>x</code>) and cons-ing (<code>:</code>) the input function to the first element <code>(f x)</code> onto the result of <code>map</code>-ing f onto the rest of the list (<code>map f xs</code>).
         </span>
      </div>
    </div>
    <div id="lines">
    </div>
  </body>
  <script>
    var toggleLessonHighlight = function(e) {
      var blahs = document.getElementsByClassName(e.target.classList[0]);
      for (var i = 0; i < blahs.length; i ++){
        blah = blahs[i];
        blah.classList.toggle("map-lesson-highlight");
      };
    };

    names = ['mapLessonRecursiveCase', 'mapLessonBaseCase', 'mapLessonTypeSignature']
    for (var j = 0; j < names.length; j++) {
      var name = names[j];

      var things = document.getElementsByClassName(name);
      for (var i = 0; i < things.length; i ++){
        thing = things[i];
        thing.addEventListener('mouseenter', toggleLessonHighlight);
        thing.addEventListener('mouseleave', toggleLessonHighlight);
      }
    }


    var _globalState = {
      lines: [{ast: window.initialAST, clickedComputationId: null}],
      applicationHighlightId: null,
      highlightedLineIndex: null,
      editingFirstLine: false,
      showHelpText: true
    };

    var changeGlobalState = function(globalStateDiff) {
      _.extend(_globalState, globalStateDiff);

      React.renderComponent(
        Lines(_globalState),
        document.getElementById('lines')
      );
    };
    changeGlobalState({});

    window.addLineByApplying = function(id) {
      var lines = _.cloneDeep(_globalState.lines);

      lines[lines.length-1].clickedComputationId = id;

      var applyInfo = ASTTransformations.applyFunction(lines[lines.length-1].ast, id);

      lines.push({
        ast: applyInfo.ast,
        clickedComputationId: null,
        justComputedId: applyInfo.justComputedId
      });

      changeGlobalState({lines: lines, showHelpText: false});
    };

    window.highlightApplicationId = function(id) {
      changeGlobalState({applicationHighlightId: id});
    };

    window.highlightLine = function(index) {
      changeGlobalState({highlightedLineIndex: index});
    };

    window.editFirstLine = function() {
      changeGlobalState({editingFirstLine: true});
    };

    window.updateInitialAST = function(id, subtree) {
      var newAST = ASTTransformations.replaceSubtree(_globalState.lines[0].ast, id, subtree);

      changeGlobalState({
        lines: [{ast: newAST, clickedComputationId: null}],
        applicationHighlightId: null,
        highlightedLineIndex: null,
        editingFirstLine: false,
        showHelpText: false
      });
    };
  </script>
</html>
