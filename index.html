<html>
  <head>
    <script src="components/Mixins.js"></script>
    <script src="bower_components/react/react-with-addons.js"></script>
    <script src="bower_components/lodash/dist/lodash.js"></script>
    <script src="bower_components/node-uuid/uuid.js"></script>
    <script src="components/LineComponent.js"></script>
    <script src="components/ApplicationComponent.js"></script>
    <script src="components/FunctionNameComponent.js"></script>
    <script src="components/ListComponent.js"></script>
    <script src="components/IntComponent.js"></script>
    <script src="components/LinesComponent.js"></script>
    <script src="components/NodeComponent.js"></script>
    <script src="ast_transformations.js"></script>
    <script src="initial_ast.js"></script>

    <link rel="stylesheet" href="app.css">
  </head>
  <body>
    <div id="lines">
    </div>
  </body>
  <script>
    var _globalState = {
      lines: [{ast: window.initialAST, clickedComputationId: null}],
      applicationHighlightId: null,
      highlightedLineIndex: null
    };

    var changeGlobalState = function(globalStateDiff) {
      _.extend(_globalState, globalStateDiff);

      React.renderComponent(
        Lines(_globalState),
        document.getElementById('lines')
      );
    };
    changeGlobalState({});

    window.addLineByApplying = function(id) {
      var lines = _.cloneDeep(_globalState.lines);

      lines[lines.length-1].clickedComputationId = id;

      var applyInfo = ASTTransformations.applyFunction(lines[lines.length-1].ast, id);

      lines.push({
        ast: applyInfo.ast,
        clickedComputationId: null,
        justComputedId: applyInfo.justComputedId
      });

      changeGlobalState({lines: lines});
    };

    window.highlightApplicationId = function(id) {
      changeGlobalState({applicationHighlightId: id});
    };

    window.highlightLine = function(index) {
      changeGlobalState({highlightedLineIndex: index});
    };
  </script>
</html>
